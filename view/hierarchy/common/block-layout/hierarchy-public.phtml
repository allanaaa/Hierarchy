<div>
    <?php
    // Show label if hierarchy_show_label checked in config
     if ($this->setting('hierarchy_show_label')) {
         echo '<h4>' . $hierarchy->getLabel() . '</h4>';
     }
    ?>
    <ul>
        <?php $iterate = function ($groupings) use (&$iterate) {
            foreach ($groupings as $grouping) {
                $groupingName = $grouping['data']['label'];
                $groupingSet = $grouping['data']['itemSet'];
                if (empty($groupingSet)) {
                    echo '<li>' . $groupingName . '</li>';
                } else {
                    try {
                        $itemSet = $this->api()->read('item_sets', $groupingSet)->getContent();
                        // Show itemSet count if hierarchy_show_count checked in config
                        $itemSetCount = $this->setting('hierarchy_show_count') ? $this->hierarchyHelper()->itemSetCount($itemSet) : '';
                        echo '<li>'  . $itemSet->link($groupingName) . $itemSetCount . '</li>';
                    } catch (NotFoundException $e) {
                        echo '<li>' . $groupingName . '</li>';
                    }
                }
                if (isset($grouping['children'])) {
                    echo '<ul>';
                    $iterate($grouping['children']);
                    echo '</ul>';
                }
            }
        };
        $iterate($hierarchyData); ?>
    </ul>
</div>
